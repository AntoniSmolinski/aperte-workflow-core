<#assign null = "null"/>
<#assign processId = process.getId()!"">
<#assign createDate = process.getCreateDate()!"">
<#assign creatorLogin = process.getCreatorLogin()!"">
<#assign attr = attributes!"">
<#assign externalId = process.getExternalId!"">
<#assign comments = comments!"">
<#assign processLogs = processLogs!"">
<#assign demand = demand!"">
<#assign demandSuppliers = demand.getContractors()>


<#assign demandResponsiblePersonLoginFullName = process.getSimpleAttributeValue("demandResponsiblePersonLoginFullName")!""/>
<#assign demandResponsiblePersonUnitFullName = process.getSimpleAttributeValue("demandResponsiblePersonUnitFullName")!""/>

<#assign demandMakingPersonLoginFullName = process.getSimpleAttributeValue("demandMakingPersonLoginFullName")!""/>
<#assign demandMakingPersonUnitFullName = process.getSimpleAttributeValue("demandMakingPersonUnitFullName")!""/>
<#assign demandMakingPersonPositionFullName = process.getSimpleAttributeValue("demandMakingPersonPositionFullName")!""/>
<#assign demandMakingPersonSupervisorFullName = process.getSimpleAttributeValue("demandMakingPersonSupervisorFullName")!""/>

<#assign demandReceivingPersonLoginFullName = process.getSimpleAttributeValue("demandReceivingPersonLoginFullName")!""/>
<#assign demandReceivingPersonUnitFullName = process.getSimpleAttributeValue("demandReceivingPersonUnitFullName")!""/>

<#assign choosenDemandType = process.getSimpleAttributeValue("choosenDemandType")!""/>
<#assign demandCompany = process.getSimpleAttributeValue("demandCompany")!""/>
<#assign demandCompanyFullName = process.getSimpleAttributeValue("demandCompanyFullName")!""/>
<#assign demandTypeOf = process.getSimpleAttributeValue("demandTypeOf")!""/>
<#assign demandFormalJustification = process.getSimpleAttributeValue("demandFormalJustification")!""/>
<#assign demandPlaceOfUse = process.getSimpleAttributeValue("demandPlaceOfUse")!""/>
<#assign demandSugestedRealizationDate = process.getSimpleAttributeValue("demandSugestedRealizationDate")!""/>
<#assign demandApprovedRealizationDate = process.getSimpleAttributeValue("demandApprovedRealizationDate")!""/>

<#assign demandWasPresentBefore = process.getSimpleAttributeValue("demandWasPresentBefore")!""/>
<#assign demandWhatIsBeingReplaced = process.getSimpleAttributeValue("demandWhatIsBeingReplaced")!""/>

<#assign demandFixedAssetsGroups = process.getSimpleAttributeValue("demandFixedAssetsGroups")!""/>

<#assign demandWasPresentInBudget = process.getSimpleAttributeValue("demandWasPresentInBudget")!""/>

<#assign demandWasPresentInProject = process.getSimpleAttributeValue("demandWasPresentInProject")!""/>
<#assign demandNumberOfProject = process.getSimpleAttributeValue("demandNumberOfProject")!""/>

<#assign demandCapexes = demand.getCapexes()/>
<#if demandCapexes?size == 0>
    <#assign demandCapexes = [{"cost":0.0, "capex":"", "month": 1}]/>
</#if>

<#assign demandCosts = demand.getCosts()/>
<#if demandCosts?size == 0>
    <#assign demandCosts = [{"cost":0.0, "account":"", "currency": "PLN"}]/>
</#if>

<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet"/>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

<script type="text/javascript">
	alert(dokument);
</script>
<table class="table table-striped" >
	<tr>
		<th>Atrybut</th>
		<th>Wartość</th>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.choose.company.label")}</td>
		<td>${demandCompanyFullName}</td>
	</tr>
	
		 <#if choosenDemandType == "fixed_assets">
			   <#assign fixedAssetsGroupsDictionary = fixedAssetsGroupsDictionary!null/>
				   <#if fixedAssetsGroupsDictionary != null>
					   <#list fixedAssetsGroupsDictionary.sortedItems(messageSource.getLocale().toString()) as dictionaryItem>
						  <#if demandFixedAssetsGroups == dictionaryItem.getKey()>
							<tr>
								<td>${messageSource.getMessage("demand.fixedasset.group.label")}</td>
								<td>
									${dictionaryItem.getValueForCurrentDate().getValue(messageSource.getLocale().toString())}
								</td>
							</tr>
						  </#if>
					   </#list>
				</#if>
		</#if>
	
			<#assign costIteration = 0/>
			<#list demandCosts as cost>
                   <#assign costAccountDictionary = costAccountDictionary!null/>
				   <#assign costIteration = costIteration + 1/>
				   <#if costAccountDictionary != null>
					   <#list costAccountDictionary.sortedItems(messageSource.getLocale().toString()) as dictionaryItem>
						  <#if cost.account == dictionaryItem.getKey()>
						  <tr>
							<td>${messageSource.getMessage("demand.cost.account.label")}</td>
							<td>
								${dictionaryItem.getValueForCurrentDate().getValue(messageSource.getLocale().toString())}</br>
								<#assign costAccountDictionary = costAccountDictionary!null/>
									   <#if costAccountDictionary != null>
										   <#list costAccountDictionary.sortedItems(messageSource.getLocale().toString()) as dictionaryItem>
									
											  <#if cost.account == dictionaryItem.getKey()>
												<div><label name="cost">${cost.cost}</label><label id="currency">&nbsp;${cost.currency}</label></div>  
												
											  </#if>
										   </#list>
									</#if>
							</td>
							</tr>
							
						  </#if>
					   </#list>
				</#if>
              </#list>
	
	<tr>
		<td>${messageSource.getMessage("demand.cost.account.sum")}</td>
		<td><label id="sumCost"></label></td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.typeof.textarea.label."+choosenDemandType)}</td>
		<td>${demandTypeOf}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.formal.justification.textarea.label")}</td>
		<td>${demandFormalJustification}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.was.replaced.present.select.label.services")}</td>
		<td>
			<#if demandWasPresentBefore == "true" >
				${messageSource.getMessage("demand.was.in.project.select.label.yes")}
				<#else> ${messageSource.getMessage("demand.was.in.project.select.label.no")}
			</#if>
		</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.was.is.beging.replaced.label")}</td>
		<td>${demandWhatIsBeingReplaced}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.was.in.budget.select.label."+choosenDemandType)}</td>
		<td>
			<#if demandWasPresentInBudget == "true" >
				${messageSource.getMessage("demand.was.in.project.select.label.yes")}
				<#else> ${messageSource.getMessage("demand.was.in.project.select.label.no")}
			</#if>
		</td>
	</tr>
	
	<tr>
		<td>${messageSource.getMessage("demand.was.in.budget.value.label")}</td>
		<td>
		<#list demandCapexes as capex>
				${messageSource.getMessage("demand.was.in.budget.capex.label")}:&nbsp; ${capex.capex},&nbsp;
				${messageSource.getMessage("demand.was.in.budget.value.label")}:&nbsp; ${capex.cost},&nbsp;
				${messageSource.getMessage("demand.was.in.budget.month.label")}:&nbsp; ${messageSource.getMessage("month.name."+capex.month)}</br>
		 </#list>
		</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.was.in.project.select.label."+choosenDemandType)}</td>
		<td>
			<#if demandWasPresentInProject == "true" >
				${messageSource.getMessage("demand.was.in.project.select.label.yes")}
				<#else> ${messageSource.getMessage("demand.was.in.project.select.label.no")}
			</#if>
		</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.was.is.beging.replaced.label")}</td>
		<td>${demandNumberOfProject}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.placeof.textarea.label."+choosenDemandType)}</td>
		<td>${demandPlaceOfUse}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.suggested.realization.date.textarea.label")}</td>
		<td>${demandSugestedRealizationDate}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.approved.realization.date.textarea.label")}</td>
		<td>${demandApprovedRealizationDate}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.reponsible.person.header.label."+choosenDemandType)}</td>
		<td>${demandResponsiblePersonLoginFullName}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.reponsible.person.header.label."+choosenDemandType)},&nbsp;${messageSource.getMessage("demand.unit.name.label")}:</td>
		<td>${demandResponsiblePersonUnitFullName}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.making.person.header.label")}</td>
		<td>${demandMakingPersonLoginFullName}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.making.person.header.label")},&nbsp;${messageSource.getMessage("demand.unit.name.label")}:</td>
		<td>${demandMakingPersonUnitFullName}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.making.person.header.label")},&nbsp;${messageSource.getMessage("demand.person.position.login.label")}:</td>
		<td>${demandMakingPersonPositionFullName}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.making.person.header.label")},&nbsp;${messageSource.getMessage("demand.person.supervisor.placeholder")}:</td>
		<td>${demandMakingPersonSupervisorFullName}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.receiving.person.header.label")}</td>
		<td>${demandReceivingPersonLoginFullName}</td>
	</tr>
	<tr>
		<td>${messageSource.getMessage("demand.receiving.person.header.label")},&nbsp;${messageSource.getMessage("demand.unit.name.label")}:</td>
		<td>${demandReceivingPersonUnitFullName}</td>
	</tr>
</table>

</br>
</br>
<#if demandSuppliers?has_content >
	<h3>${messageSource.getMessage("demand.suppliers.header.label")}</h3>
	<table class="table table-striped" >
		<tr>
               <th>${messageSource.getMessage("demand.suppliers.nip.label")}</th>
               <th>${messageSource.getMessage("demand.suppliers.name.label")}</th>
               <th>${messageSource.getMessage("demand.suppliers.email.label")}</th>
               <th>${messageSource.getMessage("demand.suppliers.telephone.label")}</th>
               <th>${messageSource.getMessage("demand.suppliers.country.label")}</th>
               <th>${messageSource.getMessage("demand.suppliers.city.label")}</th>
               <th>${messageSource.getMessage("demand.suppliers.code.label")}</th>
               <th>${messageSource.getMessage("demand.suppliers.address.label")}</th>
           </tr>
		<#list demandSuppliers as supplier>
			<tr>
				<td>${supplier.nip!""}</td>
				<td>${supplier.name!""}</td>
				<td>${supplier.email!""}</td>
				<td>${supplier.phone!""}</td>
				<td>${supplier.country!""}</td>
				<td>${supplier.city!""}</td>
				<td>${supplier.code!""}</td>
				<td>${supplier.address!""}</td>
			</tr>
		</#list>
	</table>
</#if>
</br>
</br>
<#if comments?has_content >
	<h3>${messageSource.getMessage("widget.process_comments.caption")}</h3>
	<table  class="table table-striped" >
		<tr>
			<th>${messageSource.getMessage("activity.task.history.log.author")}</th>
			<th>${messageSource.getMessage("processdata.comments.comment.form.createTime")}</th>
			<th>${messageSource.getMessage("widget.attribute.comment.description")}</th>
		</tr>
		
		<#list comments as comment>
			<tr>
				<td>${comment.authorFullName} (${comment.authorLogin})</td>
				<td>${comment.createTime?string("yyyy-MM-dd HH:mm")}</td>
				<td>${comment.getBody()}</td>
			</tr>
		</#list>
	</table>
</#if>
</br>
</br>
<#if processLogs?has_content >
	<h3>${messageSource.getMessage("widget.process_history.name")}</h3>
	<table  class="table table-striped"  >
		<tr>
			<th>${messageSource.getMessage("process.history.action.by")}</th>
			<th>${messageSource.getMessage("activity.task.history.log.entryDate")}</th>
			<th>${messageSource.getMessage("processinstances.console.history.stateDescription")}</th>
			<th>${messageSource.getMessage("")}</th>
		</tr>
		<#list processLogs as log>
			<tr>
				<td>${log.getUserLogin()}</td>
				<td>${log.getEntryDate()?string("dd-MM-yyyy HH:mm:ss")}</td>
				<td>${messageSource.getMessage(log.eventI18NKey)}</td>
				<td><#assign entryDescription = log.getAdditionalInfo()!log.getLogValue()!""/> ${messageSource.getMessage(entryDescription)}</td>
			</tr>
		</#list>
	</table>
</#if>

<script type="text/javascript">
	
	recalcuteCostSum();
	
	function recalcuteCostSum() {
		var sum = 0;
		var inva = document.getElementsByName("cost");
		for ( var i = 0; i < inva.length; i++) {
			var inc = inva[i].innerHTML.replace(/&nbsp;/g,'');
			sum = +sum + +inc;
		}
		var currency = document.getElementById("currency").innerHTML;
		document.getElementById("sumCost").innerHTML = sum + currency;
	}
	
</script>