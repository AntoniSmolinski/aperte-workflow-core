<div class="process-tasks-view" id="task-view-processes">
    <table id="default-queue-view-table" class="process-table table table-striped" border="1">
        <thead>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.name")}</th>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.step")}</th>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.businessStatus")}</th>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.code")}</th>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.creator")}</th>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.creationdate")}</th>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.deadline")}</th>
        <th style="width:10%;">${messageSource.getMessage("processes.list.table.process.actions")}</th>
        </thead>
        <tbody></tbody>
    </table>
</div>


<script type="text/javascript">

  	$(document).ready(function()
	{
		var loadedProcess = loadCookies("process");
		var parsedProcess = parseCookie(loadedProcess);

		var dataTable = new AperteDataTable("default-queue-view-table",
			[
				 { "sName":"name", "bSortable": true,"bVisible":parsedCustom.name,"mData": function(object){return generateNameColumn(object);}},
				 { "sName":"step", "bSortable": true,"bVisible":parsedCustom.step, "mData": "step" },
				 { "sName":"businessStatus", "bSortable": true ,"bVisible":parsedCustom.step, "mData": "businessStatus" },
				 { "sName":"code", "bSortable": true,"bVisible":parsedCustom.code, "mData": "code" },
				 { "sName":"creator", "bSortable": true,"bVisible":parsedCustom.creator,"mData": "creator" },
				 { "sName":"creationDate", "bSortable": true,"bVisible":parsedCustom.creationDate,"mData": function(object){return $.format.date(object.creationDate, 'dd-MM-yyyy, HH:mm:ss');}},
				 { "sName":"deadline", "bSortable": true,"bVisible":parsedCustom.deadline,"mData": function(object){return object.deadline == null ? "${messageSource.getMessage('processes.list.table.nodeadline')}" : $.format.date(object.deadline, 'dd-MM-yyyy, HH:mm');}},
				 { "sName":"actions", "bSortable": false,"bVisible":parsedCustom.actions,"mData": function(object){return generateButtons(object)}}
			 ],
			 [[ 10, "desc" ]]
			);

		dataTable.addParameter('taskListViewName','defaultQueue');
		dataTable.addParameter('queueType','queue');
		dataTable.addParameter('ownerLogin','${ownerLogin}');

		queueViewManager.addTableView('demandMyTasks', dataTable, 'taskListViewName');

        dataTable.reloadTable(processListPortlet);
	});

	function generateButtons(task)
	{
		var linkBody = '';
		if(task.queueName || (!task.assignee && task.userCanClaim))
		{
			linkBody += '<button id="link-'+task.queueName+'" class="btn btn-default btn-sm" type="button" data-toggle="tooltip" title="${messageSource.getMessage('activity.tasks.task.claim.details')}" onclick="claimTaskFromQueue(this, \''+task.queueName+'\','+task.processStateConfigurationId+','+task.taskId+'); ">${messageSource.getMessage('activity.tasks.task.claim')}"</a>';
		}

		return linkBody;
	}

	function claimTaskFromQueue(button, queueName, processStateConfigurationId, taskId)
	{
		$(button).prop('disabled', true);
		windowManager.showLoadingScreen();

		var bpmJson = $.post(claimTaskFromQueuePortlet,
		{
			"queueName": queueName,
			"taskId": taskId,
			"userId": queueViewManager.currentOwnerLogin
		}, function(task)
		{
			clearAlerts();
			reloadQueues();
			loadProcessView(task.taskId);
		})
		.fail(function(request, status, error)
		{

		});
	}
//]]>
</script>