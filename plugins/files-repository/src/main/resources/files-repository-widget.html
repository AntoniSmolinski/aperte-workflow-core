<#assign null = "null"/><#assign processInstanceId = process.getId()!""/><!-- The fileinput-button span is used to style the file input field as button --><span class="btn btn-success fileinput-button">        <i class="glyphicon glyphicon-plus"></i>        <span>${messageSource.getMessage("widget.file.repository.form.addFileBtn")}</span>        <!-- The file input field used as target for the file upload widget -->        <input id="fileupload" type="file" name="files[]">    </span><br><!-- The container for the uploaded files --><div id="files" class="files"></div><br><br><!-- The global progress bar --><div id="progress" class="progress" style="display:none;">    <div class="progress-bar progress-bar-success"></div></div><table cellpadding="0" cellspacing="0" border="0" id="files-table" class="table table-hover table-bordered">    <thead>    <tr>        <th class="name" style="width: 40px">${messageSource.getMessage("widget.file.repository.results.table.name")}        </th>        <th class="description" style="width: 120px">            ${messageSource.getMessage("widget.file.repository.results.table.description")}        </th>        <th class="createDate" style="width: 80px">            ${messageSource.getMessage("widget.file.repository.results.table.createdDate")}        </th>        <th style="width: 30px">${messageSource.getMessage("widget.file.repository.results.table.fileAction")}</th>    </tr>    </thead></table><script>function getDisptacherPortletFor(action) {    var controller = 'filescontroller';    var url = dispatcherPortlet + '&controller=' + controller + '&action=' + action + '&processInstanceId=${processInstanceId}'    return url;}// Change this to the location of your server-side upload handler:var urlUploadFile = getDisptacherPortletFor('uploadFile'),        urlGetFilesList = getDisptacherPortletFor('getFilesList'),        urlDownloadFile = getDisptacherPortletFor('downloadFile'),        urlDeleteFile = getDisptacherPortletFor('deleteFile');// Function responsible for updating rows after search results are retutned form server// * data JSON Response form servrvar oTable;function showRows(data) {    if (!oTable) {        initDataTable();    } else {        oTable.fnClearTable();    }    if (data) {        //Load data into data table        for (var index = 0; index < data.length; ++index) {            var od = data[index];            console.log("id: " + od.id);            console.log("processName: " + od.processInstanceId);            oTable.fnAddData([                od.name,                "<input name=\"file-description\" id=\"file-description\" class=\"form-control\" type=\"text\" placeholder=\"${messageSource.getMessage("widget.file.repository.results.table.description")}\" maxlength=\"100\" required=\"required\">",                od.createDate,                "<button class=\"btn btn-xs\" style=\"margin-right: 10px;\" onclick=\"downloadFile('" + od.id + "')\" alt=\"${messageSource.getMessage("widget.file.repository.results.table.downloadBtn")}\"><span class=\"glyphicon glyphicon-floppy-save\"><span></button>" +                        "<button class=\"btn btn-xs\" style=\"margin-right: 10px;\" onclick=\"deleteFile('" + od.id + "')\" alt=\"${messageSource.getMessage("widget.file.repository.results.table.deleteBtn")}\"><span class=\"glyphicon glyphicon-remove\"><span></button>"            ]);        }    }}function initDataTable() {    oTable = $('#files-table').dataTable(            {    "bFilter": false,                "aoColumn": [                    null,                    null,                    null,                    null                ],                "bPaginate": false            });    return oTable;}$(document).ready(function () {    $.getJSON(                    urlGetFilesList            )            .done(function (data) {                if (data.errors.length > 0) {                    $(data.errors).each(function (item) {                        windowManager.addError(item);                    });                    return;                }                showRows(data.data);            });    $('#fileupload').fileupload({        url: urlUploadFile,        dataType: 'json',        autoUpload: true,        maxNumberOfFiles: 1        //acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,        //maxFileSize: 5000000 // 5 MB        // Enable image resizing, except for Android and Opera,        // which actually support image resizing, but fail to        // send Blob objects via XHR requests:        //disableImageResize: /Android(?!.*Chrome)|Opera/        //        .test(window.navigator.userAgent),        //previewMaxWidth: 100,        //previewMaxHeight: 100,        //previewCrop: true    })            .on('fileuploadadd', function (e, data) {                data.context = $('<div/>').appendTo('#files');                $.each(data.files, function (index, file) {                    /*                     var node = $('<p/>')                     .append($('<span/>').text(file.name));                     if (!index) {                     node                     .append('<br>')                     .append(uploadButton.clone(true).data(data));                     }                     node.appendTo(data.context);                     */                    $('#files-table').dataTable().fnAddData([file.name, '<input id="file-description" class="form-control" type="text" placeholder="Opis" maxlength="100" required="required">', $.format.date(new Date(), 'yyyy-MM-dd HH:mm:ss'), '<a class="delete" href="#">UsuĹ</a>']);                    $('#files-table a.delete').on("click", function (event) {                        event.preventDefault();                        if (confirm('Czy na pewno chcesz usunÄÄ ten plik?')) {                            var nRow = $(this).parents('tr')[0];                            $('#files-table').dataTable().fnDeleteRow(nRow);                        }                    });                });            })            .on('fileuploadprocessalways', function (e, data) {                var index = data.index,                        file = data.files[index],                        node = $(data.context.children()[index]);                if (file.preview) {                    node                            .prepend('<br>')                            .prepend(file.preview);                }                if (file.error) {                    node                            .append('<br>')                            .append($('<span class="text-danger"/>').text(file.error));                }                if (index + 1 === data.files.length) {                    data.context.find('button')                            .text('Upload')                            .prop('disabled', !!data.files.error);                }            })            .on('fileuploadprogressall', function (e, data) {                $('#progress').show();                var progress = parseInt(data.loaded / data.total * 100, 10);                $('#progress .progress-bar').css(                        'width',                        progress + '%'                );            })            .on('fileuploaddone',function (e, data) {                $('#progress').hide();                if (data.errors.length > 0) {                    $(data.errors).each(function (item) {                        windowManager.addError(item);                    });                    return;                }//                    $.each(data.result.files, function (index, file) {//                        if (file.url) {//                            var link = $('<a>')//                                    .attr('target', '_blank')//                                    .prop('href', file.url);//                            $(data.context.children()[index])//                                    .wrap(link);//                        } else if (file.error) {//                            var error = $('<span class="text-danger"/>').text(file.error);//                            $(data.context.children()[index])//                                    .append('<br>')//                                    .append(error);//                        }//                    });            }).on('fileuploadfail',function (e, data) {                if (data.errors.length > 0) {                    $(data.errors).each(function (item) {                        windowManager.addError(item);                    });                    return;                }                $.each(data.files, function (index, file) {                    var error = $('<span class="text-danger"/>').text('File upload failed.');                    $(data.context.children()[index])                            .append('<br>')                            .append(error);                    <!-- Errors handling -->                    windowManager.clearErrors();                    var errors = [];                    $.each(data.errors, function () {                        errors.push(this);                        windowManager.addError(this.message);                    });                    if (errors.length > 0) {                        return;                    }                });            }).prop('disabled', !$.support.fileInput)            .parent().addClass($.support.fileInput ? undefined : 'disabled');});function deleteFile(itemId) {    $.getJSON(                    urlDeleteFile + '&filesRepositoryItemId=' + itemId            )            .done(function (data) {                if (data.errors.length > 0) {                    $(data.errors).each(function (item) {                        windowManager.addError(item);                    });                    return;                }                showRows(data.data);            });}function downloadURL(url) {    var hiddenIFrameID = 'hiddenDownloader',            iframe = document.getElementById(hiddenIFrameID);    if (iframe === null) {        iframe = document.createElement('iframe');        iframe.id = hiddenIFrameID;        iframe.style.display = 'none';        document.body.appendChild(iframe);    }    iframe.src = url;};function downloadFile(itemId) {    downloadURL(urlDownloadFile + '&filesRepositoryItemId=' + itemId);}</script><style type="text/css">    @charset "UTF-8";    /*     * jQuery File Upload Plugin CSS 1.3.0     * https://github.com/blueimp/jQuery-File-Upload     *     * Copyright 2013, Sebastian Tschan     * https://blueimp.net     *     * Licensed under the MIT license:     * http://www.opensource.org/licenses/MIT     */    .fileinput-button {        position: relative;        overflow: hidden;    }    .fileinput-button input {        position: absolute;        top: 0;        right: 0;        margin: 0;        opacity: 0;        -ms-filter: 'alpha(opacity=0)';        font-size: 200px;        direction: ltr;        cursor: pointer;    }    /* Fixes for IE < 8 */    @media screen\9  {        .fileinput-button input {            filter: alpha(opacity=0);            font-size: 100%;            height: 100%;        }    }</style>